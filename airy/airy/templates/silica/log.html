{% extends "silica/base.html" %}
{% import "silica/macros.html" as macros %}

{% block title %}{{ _("ログ") }}{% endblock %}

{% block content %}
<form method="GET" action="?">
	{{ form.sid2.label }} {{ form.sid2 }}
	<div class="errors">
		<ul>
			{% for error in form.errors.sid2 %}
				<li>{{ error }}</li>
			{% endfor %}
		</ul>
	</div>
	<input type="submit" value="{{ _("検索") }}">
</form>

<table>
	<tr>
		<th>ログID</th>
		<th>セッションID</th>
		<th>時刻</th>
		<th>データ</th>
	</tr>
	{% for le in les.items %}
		<tr>
			<td>
				{{ le.id }}
			</td>
			<td>
				{{ macros.sid2_with_query(le.sid2) }}
			</td>
			<td>
				{{ macros.time(le.created) }}
			</td>
			<td>
				{% if le.renderer == "login_choose" %}
					認証パス{{ macros.ap(le.data.apid | get_ap) }}を選びます。
				{% elif le.renderer == "login_attempt" %}
					認証方法{{ macros.af(le.data.afid | get_af) }}を選びます。
					{% if le.data.cur_done %}
						このステップで<strong>ログインしました。</strong>
					{% endif %}
				{% elif le.renderer == "login_start" %}
					{{ le.data.extra.remote }}からログインを開始します。<br />
					ユーザーエージェント：{{ le.data.extra.headers.key[0] }}
				{% elif le.renderer == "remote" %}
					遠隔認証トークン<code>{{ le.data.token }}</code>を承認しました。
				{% else %}
					<code>{{ le.data | tojson }}</code>
				{% endif %}
			</td>
		</tr>
	{% endfor %}
</table>

{{ _('ページ') }}
{% if les.prev_num %}
  <a href="?page={{ les.prev_num }}">{{ _('前') }}</a>
{% endif %}
{% for page in les.iter_pages() %}
  {% if page == les.page %}
    <span>{{ page }}</span>
  {% elif page == None %}
    …
  {% else %}
    <a href="?page={{ page }}">{{ page }}</a>
  {% endif %}
{% endfor %}
{% if les.next_num %}
  <a href="?page={{ les.next_num }}">{{ _('次') }}</a>
{% endif %}
{% endblock %}
