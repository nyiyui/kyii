var Ve=Object.defineProperty;var $e=Object.getOwnPropertySymbols;var Be=Object.prototype.hasOwnProperty,Oe=Object.prototype.propertyIsEnumerable;var ke=(o,e,n)=>e in o?Ve(o,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):o[e]=n,ce=(o,e)=>{for(var n in e||(e={}))Be.call(e,n)&&ke(o,n,e[n]);if($e)for(var n of $e(e))Oe.call(e,n)&&ke(o,n,e[n]);return o};import{S as Le,i as Me,s as Re,a3 as se,a4 as fe,e as S,w as F,c as I,a as A,x as J,d as p,b as y,g as E,y as H,a6 as ae,q as b,o as w,B as T,K as te,Y as qe,k as P,m as D,J as $,t as O,h as q,j as Y,p as X,l as ue,a2 as Ce,M as Fe,a1 as we,_ as _e,G as Je,v as He,n as Z,E as Te}from"../chunks/index-471c5598.js";import{Y as Ue,u as Ye,a as pe,g as Ee}from"../chunks/api2-564f7f8d.js";import{p as je}from"../chunks/stores-08fbc986.js";import{c as Ge}from"../chunks/store-669d404b.js";import{g as Ke,A as me}from"../chunks/util-92d9fe41.js";import{I as ne}from"../chunks/Icon-b960e3f0.js";import{B as ge}from"../chunks/Box-a27f9004.js";import{a as ze}from"../chunks/AFChallenge-c287a838.js";import{S as Qe}from"../chunks/Select-4d017f13.js";import"../chunks/index-0b2b7ad8.js";import"../chunks/singletons-d1fb5791.js";import"../chunks/Loading-28866ca5.js";import"../chunks/BoxError-e4fbeeb7.js";function We(o){let e,n,i,t;function r(s){o[6](s)}let l={items:o[0],placeholder:o[2]("ap_select.placeholder")};return o[1]!==void 0&&(l.value=o[1]),n=new Qe({props:l}),se.push(()=>fe(n,"value",r)),n.$on("select",o[3]),{c(){e=S("div"),F(n.$$.fragment),this.h()},l(s){e=I(s,"DIV",{class:!0});var f=A(e);J(n.$$.fragment,f),f.forEach(p),this.h()},h(){y(e,"class","ap-select")},m(s,f){E(s,e,f),H(n,e,null),t=!0},p(s,[f]){const c={};f&1&&(c.items=s[0]),f&4&&(c.placeholder=s[2]("ap_select.placeholder")),!i&&f&2&&(i=!0,c.value=s[1],ae(()=>i=!1)),n.$set(c)},i(s){t||(b(n.$$.fragment,s),t=!0)},o(s){w(n.$$.fragment,s),t=!1},d(s){s&&p(e),T(n)}}}function Xe(o,e,n){let i;te(o,Ue,a=>n(2,i=a));const t=qe();let{aps:r}=e,{chosen:l}=e,s,f;function c(){n(4,l=f.value),t("choose")}function u(a){f=a,n(1,f)}return o.$$set=a=>{"aps"in a&&n(5,r=a.aps),"chosen"in a&&n(4,l=a.chosen)},o.$$.update=()=>{o.$$.dirty&32&&n(0,s=r.map(a=>({value:a.uuid,label:a.name})))},[s,f,i,c,l,r,u]}class Ze extends Le{constructor(e){super();Me(this,e,Xe,We,Re,{aps:5,chosen:4})}}function Se(o,e,n){const i=o.slice();return i[25]=e[n],i[26]=e,i[27]=n,i}function xe(o){let e,n,i=o[12]("login.user_not_found")+"",t,r;return e=new ne({props:{icon:"mdi:account-cancel",style:"color: var(--color-error);"}}),{c(){F(e.$$.fragment),n=P(),t=O(i)},l(l){J(e.$$.fragment,l),n=D(l),t=q(l,i)},m(l,s){H(e,l,s),E(l,n,s),E(l,t,s),r=!0},p(l,s){(!r||s&4096)&&i!==(i=l[12]("login.user_not_found")+"")&&Y(t,i)},i(l){r||(b(e.$$.fragment,l),r=!0)},o(l){w(e.$$.fragment,l),r=!1},d(l){T(e,l),l&&p(n),l&&p(t)}}}function el(o){let e,n,i=o[12]("login.user_mulpu")+"",t,r;return e=new ne({props:{icon:"mdi:account-cancel",style:"color: var(--color-warn);"}}),{c(){F(e.$$.fragment),n=P(),t=O(i)},l(l){J(e.$$.fragment,l),n=D(l),t=q(l,i)},m(l,s){H(e,l,s),E(l,n,s),E(l,t,s),r=!0},p(l,s){(!r||s&4096)&&i!==(i=l[12]("login.user_mulpu")+"")&&Y(t,i)},i(l){r||(b(e.$$.fragment,l),r=!0)},o(l){w(e.$$.fragment,l),r=!1},d(l){T(e,l),l&&p(n),l&&p(t)}}}function ll(o){let e,n;return e=new ne({props:{icon:"mdi:account-check",style:"color: var(--color-ok);"}}),{c(){F(e.$$.fragment)},l(i){J(e.$$.fragment,i)},m(i,t){H(e,i,t),n=!0},p:Te,i(i){n||(b(e.$$.fragment,i),n=!0)},o(i){w(e.$$.fragment,i),n=!1},d(i){T(e,i)}}}function Ie(o){let e,n,i,t=!o[4]&&Pe(o),r=o[5]&&De(o);return{c(){e=S("div"),t&&t.c(),n=P(),r&&r.c(),this.h()},l(l){e=I(l,"DIV",{class:!0});var s=A(e);t&&t.l(s),n=D(s),r&&r.l(s),s.forEach(p),this.h()},h(){y(e,"class","flex svelte-1tlmfap")},m(l,s){E(l,e,s),t&&t.m(e,null),$(e,n),r&&r.m(e,null),i=!0},p(l,s){l[4]?t&&(Z(),w(t,1,1,()=>{t=null}),X()):t?(t.p(l,s),s&16&&b(t,1)):(t=Pe(l),t.c(),b(t,1),t.m(e,n)),l[5]?r?(r.p(l,s),s&32&&b(r,1)):(r=De(l),r.c(),b(r,1),r.m(e,null)):r&&(Z(),w(r,1,1,()=>{r=null}),X())},i(l){i||(b(t),b(r),i=!0)},o(l){w(t),w(r),i=!1},d(l){l&&p(e),t&&t.d(),r&&r.d()}}}function Pe(o){let e,n,i=o[12]("login.aps")+"",t,r,l,s,f,c,u,a,g;l=new ge({props:{level:"debug",$$slots:{default:[tl]},$$scope:{ctx:o}}}),f=new ge({props:{level:"debug",$$slots:{default:[nl]},$$scope:{ctx:o}}});function M(v){o[18](v)}let V={aps:o[9]};return o[0]!==void 0&&(V.chosen=o[0]),u=new Ze({props:V}),se.push(()=>fe(u,"chosen",M)),u.$on("select",o[15]),{c(){e=S("div"),n=S("h2"),t=O(i),r=P(),F(l.$$.fragment),s=P(),F(f.$$.fragment),c=P(),F(u.$$.fragment),this.h()},l(v){e=I(v,"DIV",{class:!0});var m=A(e);n=I(m,"H2",{});var k=A(n);t=q(k,i),k.forEach(p),r=D(m),J(l.$$.fragment,m),s=D(m),J(f.$$.fragment,m),c=D(m),J(u.$$.fragment,m),m.forEach(p),this.h()},h(){y(e,"class","padded flex-in")},m(v,m){E(v,e,m),$(e,n),$(n,t),$(e,r),H(l,e,null),$(e,s),H(f,e,null),$(e,c),H(u,e,null),g=!0},p(v,m){(!g||m&4096)&&i!==(i=v[12]("login.aps")+"")&&Y(t,i);const k={};m&268435968&&(k.$$scope={dirty:m,ctx:v}),l.$set(k);const B={};m&268435457&&(B.$$scope={dirty:m,ctx:v}),f.$set(B);const j={};m&512&&(j.aps=v[9]),!a&&m&1&&(a=!0,j.chosen=v[0],ae(()=>a=!1)),u.$set(j)},i(v){g||(b(l.$$.fragment,v),b(f.$$.fragment,v),b(u.$$.fragment,v),g=!0)},o(v){w(l.$$.fragment,v),w(f.$$.fragment,v),w(u.$$.fragment,v),g=!1},d(v){v&&p(e),T(l),T(f),T(u)}}}function tl(o){let e,n=JSON.stringify(o[9],null,2)+"",i;return{c(){e=S("pre"),i=O(n)},l(t){e=I(t,"PRE",{});var r=A(e);i=q(r,n),r.forEach(p)},m(t,r){E(t,e,r),$(e,i)},p(t,r){r&512&&n!==(n=JSON.stringify(t[9],null,2)+"")&&Y(i,n)},d(t){t&&p(e)}}}function nl(o){let e,n,i;return{c(){e=O("APID: "),n=S("code"),i=O(o[0])},l(t){e=q(t,"APID: "),n=I(t,"CODE",{});var r=A(n);i=q(r,o[0]),r.forEach(p)},m(t,r){E(t,e,r),E(t,n,r),$(n,i)},p(t,r){r&1&&Y(i,t[0])},d(t){t&&p(e),t&&p(n)}}}function De(o){let e,n,i=o[12]("login.afs")+"",t,r,l,s,f;l=new ge({props:{level:"debug",$$slots:{default:[ol]},$$scope:{ctx:o}}});let c=o[10]&&ye(o);return{c(){e=S("div"),n=S("h2"),t=O(i),r=P(),F(l.$$.fragment),s=P(),c&&c.c(),this.h()},l(u){e=I(u,"DIV",{class:!0});var a=A(e);n=I(a,"H2",{});var g=A(n);t=q(g,i),g.forEach(p),r=D(a),J(l.$$.fragment,a),s=D(a),c&&c.l(a),a.forEach(p),this.h()},h(){y(e,"class","padded flex-in afs svelte-1tlmfap")},m(u,a){E(u,e,a),$(e,n),$(n,t),$(e,r),H(l,e,null),$(e,s),c&&c.m(e,null),f=!0},p(u,a){(!f||a&4096)&&i!==(i=u[12]("login.afs")+"")&&Y(t,i);const g={};a&268436480&&(g.$$scope={dirty:a,ctx:u}),l.$set(g),u[10]?c?(c.p(u,a),a&1024&&b(c,1)):(c=ye(u),c.c(),b(c,1),c.m(e,null)):c&&(Z(),w(c,1,1,()=>{c=null}),X())},i(u){f||(b(l.$$.fragment,u),b(c),f=!0)},o(u){w(l.$$.fragment,u),w(c),f=!1},d(u){u&&p(e),T(l),c&&c.d()}}}function ol(o){let e,n=JSON.stringify(o[10],null,2)+"",i;return{c(){e=S("pre"),i=O(n)},l(t){e=I(t,"PRE",{});var r=A(e);i=q(r,n),r.forEach(p)},m(t,r){E(t,e,r),$(e,i)},p(t,r){r&1024&&n!==(n=JSON.stringify(t[10],null,2)+"")&&Y(i,n)},d(t){t&&p(e)}}}function ye(o){let e,n,i=o[10],t=[];for(let l=0;l<i.length;l+=1)t[l]=Ae(Se(o,i,l));const r=l=>w(t[l],1,1,()=>{t[l]=null});return{c(){for(let l=0;l<t.length;l+=1)t[l].c();e=ue()},l(l){for(let s=0;s<t.length;s+=1)t[s].l(l);e=ue()},m(l,s){for(let f=0;f<t.length;f+=1)t[f].m(l,s);E(l,e,s),n=!0},p(l,s){if(s&68680){i=l[10];let f;for(f=0;f<i.length;f+=1){const c=Se(l,i,f);t[f]?(t[f].p(c,s),b(t[f],1)):(t[f]=Ae(c),t[f].c(),b(t[f],1),t[f].m(e.parentNode,e))}for(Z(),f=i.length;f<t.length;f+=1)r(f);X()}},i(l){if(!n){for(let s=0;s<i.length;s+=1)b(t[s]);n=!0}},o(l){t=t.filter(Boolean);for(let s=0;s<t.length;s+=1)w(t[s]);n=!1},d(l){Ce(t,l),l&&p(e)}}}function Ae(o){let e,n,i,t;function r(f){o[19](f,o[25],o[26],o[27])}function l(f){o[20](f,o[25])}let s={uid:o[3],callback:o[16],result:o[11].get(o[25].uuid)};return o[25]!==void 0&&(s.af=o[25]),o[6][o[25].uuid]!==void 0&&(s.attempt=o[6][o[25].uuid]),e=new ze({props:s}),se.push(()=>fe(e,"af",r)),se.push(()=>fe(e,"attempt",l)),{c(){F(e.$$.fragment)},l(f){J(e.$$.fragment,f)},m(f,c){H(e,f,c),t=!0},p(f,c){o=f;const u={};c&8&&(u.uid=o[3]),c&3072&&(u.result=o[11].get(o[25].uuid)),!n&&c&1024&&(n=!0,u.af=o[25],ae(()=>n=!1)),!i&&c&1088&&(i=!0,u.attempt=o[6][o[25].uuid],ae(()=>i=!1)),e.$set(u)},i(f){t||(b(e.$$.fragment,f),t=!0)},o(f){w(e.$$.fragment,f),t=!1},d(f){T(e,f)}}}function il(o){let e,n,i=o[12]("login.pending")+"",t,r;return e=new ne({props:{icon:"mdi:checkbox-blank-circle-outline",style:"color: #ccc;"}}),{c(){F(e.$$.fragment),n=P(),t=O(i)},l(l){J(e.$$.fragment,l),n=D(l),t=q(l,i)},m(l,s){H(e,l,s),E(l,n,s),E(l,t,s),r=!0},p(l,s){(!r||s&4096)&&i!==(i=l[12]("login.pending")+"")&&Y(t,i)},i(l){r||(b(e.$$.fragment,l),r=!0)},o(l){w(e.$$.fragment,l),r=!1},d(l){T(e,l),l&&p(n),l&&p(t)}}}function rl(o){let e,n,i=o[12]("login.logged_in")+"",t,r,l,s,f,c;e=new ne({props:{icon:"mdi:check-circle",style:"color: #cfc;"}});let u=o[7]&&Ne(o);return{c(){F(e.$$.fragment),n=P(),t=O(i),r=P(),l=S("br"),s=P(),u&&u.c(),f=ue()},l(a){J(e.$$.fragment,a),n=D(a),t=q(a,i),r=D(a),l=I(a,"BR",{}),s=D(a),u&&u.l(a),f=ue()},m(a,g){H(e,a,g),E(a,n,g),E(a,t,g),E(a,r,g),E(a,l,g),E(a,s,g),u&&u.m(a,g),E(a,f,g),c=!0},p(a,g){(!c||g&4096)&&i!==(i=a[12]("login.logged_in")+"")&&Y(t,i),a[7]?u?u.p(a,g):(u=Ne(a),u.c(),u.m(f.parentNode,f)):u&&(u.d(1),u=null)},i(a){c||(b(e.$$.fragment,a),c=!0)},o(a){w(e.$$.fragment,a),c=!1},d(a){T(e,a),a&&p(n),a&&p(t),a&&p(r),a&&p(l),a&&p(s),u&&u.d(a),a&&p(f)}}}function Ne(o){let e,n=o[12]("login.next")+"",i,t;return{c(){e=S("a"),i=O(n),this.h()},l(r){e=I(r,"A",{href:!0});var l=A(e);i=q(l,n),l.forEach(p),this.h()},h(){y(e,"href",t=o[7].toString())},m(r,l){E(r,e,l),$(e,i)},p(r,l){l&4096&&n!==(n=r[12]("login.next")+"")&&Y(i,n),l&128&&t!==(t=r[7].toString())&&y(e,"href",t)},d(r){r&&p(e)}}}function sl(o){let e,n,i,t,r,l,s,f=o[12]("login.username")+"",c,u,a,g,M,V,v,m,k,B,j,z,C,N,R,K,le,oe;document.title=e=o[12]("header.login");const ie=[ll,el,xe],_=[];function U(d,L){return d[2]===!0?0:d[2]==="mulpu"?1:d[2]===!1?2:-1}~(m=U(o))&&(k=_[m]=ie[m](o));let h=o[2]===!0&&Ie(o);const W=[rl,il],Q=[];function de(d,L){return d[8]===!0?0:1}return N=de(o),R=Q[N]=W[N](o),{c(){n=P(),i=S("main"),t=S("form"),r=S("div"),l=S("div"),s=S("label"),c=O(f),u=P(),a=S("input"),g=P(),M=S("input"),v=P(),k&&k.c(),B=P(),h&&h.c(),j=P(),z=S("div"),C=S("div"),R.c(),this.h()},l(d){Fe('[data-svelte="svelte-2iox5a"]',document.head).forEach(p),n=D(d),i=I(d,"MAIN",{class:!0});var x=A(i);t=I(x,"FORM",{id:!0});var G=A(t);r=I(G,"DIV",{id:!0});var he=A(r);l=I(he,"DIV",{id:!0});var ee=A(l);s=I(ee,"LABEL",{});var re=A(s);c=q(re,f),u=D(re),a=I(re,"INPUT",{id:!0,type:!0,autocomplete:!0}),re.forEach(p),g=D(ee),M=I(ee,"INPUT",{type:!0}),v=D(ee),k&&k.l(ee),ee.forEach(p),he.forEach(p),B=D(G),h&&h.l(G),j=D(G),z=I(G,"DIV",{id:!0});var be=A(z);C=I(be,"DIV",{id:!0,class:!0});var ve=A(C);R.l(ve),ve.forEach(p),be.forEach(p),G.forEach(p),x.forEach(p),this.h()},h(){y(a,"id","username"),y(a,"type","username"),y(a,"autocomplete","username"),y(M,"type","button"),M.value=V=o[12]("login.next"),y(l,"id","login-u"),y(r,"id","login-top"),y(C,"id","login-status"),y(C,"class","svelte-1tlmfap"),y(z,"id","login-bottom"),y(t,"id","login"),y(i,"class","login-start")},m(d,L){E(d,n,L),E(d,i,L),$(i,t),$(t,r),$(r,l),$(l,s),$(s,c),$(s,u),$(s,a),we(a,o[1]),$(l,g),$(l,M),$(l,v),~m&&_[m].m(l,null),$(t,B),h&&h.m(t,null),$(t,j),$(t,z),$(z,C),Q[N].m(C,null),K=!0,le||(oe=[_e(a,"input",o[17]),_e(a,"input",o[13]),_e(M,"click",o[14])],le=!0)},p(d,[L]){(!K||L&4096)&&e!==(e=d[12]("header.login"))&&(document.title=e),(!K||L&4096)&&f!==(f=d[12]("login.username")+"")&&Y(c,f),L&2&&we(a,d[1]),(!K||L&4096&&V!==(V=d[12]("login.next")))&&(M.value=V);let x=m;m=U(d),m===x?~m&&_[m].p(d,L):(k&&(Z(),w(_[x],1,1,()=>{_[x]=null}),X()),~m?(k=_[m],k?k.p(d,L):(k=_[m]=ie[m](d),k.c()),b(k,1),k.m(l,null)):k=null),d[2]===!0?h?(h.p(d,L),L&4&&b(h,1)):(h=Ie(d),h.c(),b(h,1),h.m(t,j)):h&&(Z(),w(h,1,1,()=>{h=null}),X());let G=N;N=de(d),N===G?Q[N].p(d,L):(Z(),w(Q[G],1,1,()=>{Q[G]=null}),X(),R=Q[N],R?R.p(d,L):(R=Q[N]=W[N](d),R.c()),b(R,1),R.m(C,null))},i(d){K||(b(k),b(h),b(R),K=!0)},o(d){w(k),w(h),w(R),K=!1},d(d){d&&p(n),d&&p(i),~m&&_[m].d(),h&&h.d(),Q[N].d(),le=!1,Je(oe)}}}function fl(o,e,n){let i,t,r,l;te(o,Ge,_=>n(21,i=_)),te(o,Ye,_=>n(22,t=_)),te(o,je,_=>n(23,r=_)),te(o,Ue,_=>n(12,l=_));let s,f,c,u,a=!1,g,M=new Map,V;V=Ke(r.url.searchParams);let v,m=[],k=[],B=new Map;function j(_){for(const U of t)if(U[1].slug===_)return!0;return!1}async function z(){const _=new URL(window.location.toString());_.searchParams.set("slug",encodeURIComponent(s)),window.history.replaceState({},"",_),!i&&j(s)?n(2,f="mulpu"):n(2,f=null)}async function C(){const _=await pe.loginStart(s);if(!_){n(2,f=!1);return}if(n(2,f=!0),n(3,{uid:c,aps:m}=_,c,n(9,m)),n(4,u=m.length==1),u){const U=m[0];console.log(`${U.uuid}\u3092\u81EA\u52D5\u9078\u629E`),n(0,g=U.uuid),N()}}He(async()=>{const _=new URLSearchParams(window.location.search).get("slug");_&&(console.log("using slug specified by query params",_),n(1,s=_),await C())});async function N(){console.log(`choosing ${g}`);const _=await pe.loginChoose(g);if(_===void 0){alert("Login failed");return}n(10,{afs:k}=_,k),n(5,a=!0)}async function R(_,U){try{const h=await pe.loginAttempt(_,U);let W={feedback:h.feedback};return h.cur_done?(n(8,v=h.all_done),B.set(_,ce({status:me.Success,msg:""},W)),v&&(V?Ee(V):Ee("/login"))):B.set(_,ce({status:me.Fail,msg:h.msg},W)),h.feedback}catch(h){B.set(_,{status:me.Error,msg:h.toString()})}n(11,B)}function K(){s=this.value,n(1,s)}function le(_){g=_,n(0,g)}function oe(_,U,h,W){h[W]=_,n(10,k)}function ie(_,U){o.$$.not_equal(M[U.uuid],_)&&(M[U.uuid]=_,n(6,M))}return o.$$.update=()=>{o.$$.dirty&1&&g&&N()},[g,s,f,c,u,a,M,V,v,m,k,B,l,z,C,N,R,K,le,oe,ie]}class El extends Le{constructor(e){super();Me(this,e,fl,sl,Re,{})}}export{El as default};
