var ve=Object.defineProperty,$e=Object.defineProperties;var be=Object.getOwnPropertyDescriptors;var X=Object.getOwnPropertySymbols;var ye=Object.prototype.hasOwnProperty,we=Object.prototype.propertyIsEnumerable;var Z=(t,e,n)=>e in t?ve(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,F=(t,e)=>{for(var n in e||(e={}))ye.call(e,n)&&Z(t,n,e[n]);if(X)for(var n of X(e))we.call(e,n)&&Z(t,n,e[n]);return t},G=(t,e)=>$e(t,be(e));import{S as ae,i as fe,s as ce,k as q,e as D,m as j,c as I,b as N,g as y,_ as Q,t as P,a as z,h as J,d as v,J as S,j as R,w as L,x as B,L as x,y as T,n as H,o as b,p as Y,q as $,B as V,K as O,Y as _e,E as A,l as M,a2 as ke,$ as Ee,a0 as Se}from"./index-471c5598.js";import{u as K,Y as me,a as U,c as Ne,U as ee}from"./api2-564f7f8d.js";import{B as W}from"./Box-a27f9004.js";import{L as Ue}from"./Loading-28866ca5.js";import{U as he}from"./User-cc9f1c18.js";import{B as De}from"./BoxError-e4fbeeb7.js";import{d as de,b as pe}from"./store-669d404b.js";function Ie(t){let e,n;return e=new he({props:{uid:t[0].uid,name:t[0].name,slug:t[0].slug}}),{c(){L(e.$$.fragment)},l(l){B(e.$$.fragment,l)},m(l,o){T(e,l,o),n=!0},p(l,o){const s={};o&1&&(s.uid=l[0].uid),o&1&&(s.name=l[0].name),o&1&&(s.slug=l[0].slug),e.$set(s)},i(l){n||($(e.$$.fragment,l),n=!0)},o(l){b(e.$$.fragment,l),n=!1},d(l){V(e,l)}}}function qe(t){let e,n;return e=new he({props:{uid:"anonymous",name:"",slug:""}}),{c(){L(e.$$.fragment)},l(l){B(e.$$.fragment,l)},m(l,o){T(e,l,o),n=!0},p:A,i(l){n||($(e.$$.fragment,l),n=!0)},o(l){b(e.$$.fragment,l),n=!1},d(l){V(e,l)}}}function je(t){let e,n=JSON.stringify(t[0])+"",l;return{c(){e=D("code"),l=P(n)},l(o){e=I(o,"CODE",{});var s=z(e);l=J(s,n),s.forEach(v)},m(o,s){y(o,e,s),S(e,l)},p(o,s){s&1&&n!==(n=JSON.stringify(o[0])+"")&&R(l,n)},d(o){o&&v(e)}}}function le(t){let e,n,l,o,s,a,d,r=t[0].invalid&&ne(t),c=t[4]&&oe(t);return{c(){r&&r.c(),e=q(),c&&c.c(),n=q(),l=D("input"),this.h()},l(u){r&&r.l(u),e=j(u),c&&c.l(u),n=j(u),l=I(u,"INPUT",{class:!0,type:!0}),this.h()},h(){N(l,"class","action warn svelte-jycshq"),N(l,"type","button"),l.value=o=t[3]("iori.ulo.logout"),l.disabled=s=t[1]&&t[0].invalid&&!t[5]},m(u,g){r&&r.m(u,g),y(u,e,g),c&&c.m(u,g),y(u,n,g),y(u,l,g),a||(d=Q(l,"click",t[7]),a=!0)},p(u,g){u[0].invalid?r?r.p(u,g):(r=ne(u),r.c(),r.m(e.parentNode,e)):r&&(r.d(1),r=null),u[4]?c?c.p(u,g):(c=oe(u),c.c(),c.m(n.parentNode,n)):c&&(c.d(1),c=null),g&8&&o!==(o=u[3]("iori.ulo.logout"))&&(l.value=o),g&35&&s!==(s=u[1]&&u[0].invalid&&!u[5])&&(l.disabled=s)},d(u){r&&r.d(u),u&&v(e),c&&c.d(u),u&&v(n),u&&v(l),a=!1,d()}}}function ne(t){let e,n=t[3]("iori.ulo.invalid")+"",l;return{c(){e=D("span"),l=P(n),this.h()},l(o){e=I(o,"SPAN",{class:!0});var s=z(e);l=J(s,n),s.forEach(v),this.h()},h(){N(e,"class","tag invalid svelte-jycshq")},m(o,s){y(o,e,s),S(e,l)},p(o,s){s&8&&n!==(n=o[3]("iori.ulo.invalid")+"")&&R(l,n)},d(o){o&&v(e)}}}function oe(t){let e,n,l,o,s;return{c(){e=D("input"),this.h()},l(a){e=I(a,"INPUT",{class:!0,type:!0}),this.h()},h(){N(e,"class","action delete svelte-jycshq"),N(e,"type","button"),e.value=n=t[3]("iori.ulo.delete"),e.disabled=l=t[1]||!t[5]},m(a,d){y(a,e,d),o||(s=Q(e,"click",t[8]),o=!0)},p(a,d){d&8&&n!==(n=a[3]("iori.ulo.delete"))&&(e.value=n),d&34&&l!==(l=a[1]||!a[5])&&(e.disabled=l)},d(a){a&&v(e),o=!1,s()}}}function te(t){let e,n,l,o;return{c(){e=D("input"),this.h()},l(s){e=I(s,"INPUT",{class:!0,type:!0}),this.h()},h(){N(e,"class","action ok svelte-jycshq"),N(e,"type","button"),e.value=n=t[3]("iori.ulo.choose")},m(s,a){y(s,e,a),l||(o=Q(e,"click",t[9]),l=!0)},p(s,a){a&8&&n!==(n=s[3]("iori.ulo.choose"))&&(e.value=n)},d(s){s&&v(e),l=!1,o()}}}function Le(t){let e,n,l,o,s,a,d,r,c,u,g;const k=[qe,Ie],h=[];function p(i,m){return i[0]==="anonymous"?0:1}l=p(t),o=h[l]=k[l](t),a=new W({props:{level:"debug",$$slots:{default:[je]},$$scope:{ctx:t}}});let _=t[0]!=="anonymous"&&le(t),f=!t[1]&&!t[0].invalid&&te(t);return u=new De({props:{msg:t[2]?t[2].toString():null,passive:!0}}),{c(){e=D("div"),n=D("div"),o.c(),s=q(),L(a.$$.fragment),d=q(),_&&_.c(),r=q(),f&&f.c(),c=q(),L(u.$$.fragment),this.h()},l(i){e=I(i,"DIV",{class:!0});var m=z(e);n=I(m,"DIV",{class:!0});var E=z(n);o.l(E),E.forEach(v),s=j(m),B(a.$$.fragment,m),d=j(m),_&&_.l(m),r=j(m),f&&f.l(m),c=j(m),B(u.$$.fragment,m),m.forEach(v),this.h()},h(){N(n,"class","user svelte-jycshq"),N(e,"class","ulo svelte-jycshq"),x(e,"outline",t[1])},m(i,m){y(i,e,m),S(e,n),h[l].m(n,null),S(e,s),T(a,e,null),S(e,d),_&&_.m(e,null),S(e,r),f&&f.m(e,null),S(e,c),T(u,e,null),g=!0},p(i,[m]){let E=l;l=p(i),l===E?h[l].p(i,m):(H(),b(h[E],1,1,()=>{h[E]=null}),Y(),o=h[l],o?o.p(i,m):(o=h[l]=k[l](i),o.c()),$(o,1),o.m(n,null));const w={};m&2049&&(w.$$scope={dirty:m,ctx:i}),a.$set(w),i[0]!=="anonymous"?_?_.p(i,m):(_=le(i),_.c(),_.m(e,r)):_&&(_.d(1),_=null),!i[1]&&!i[0].invalid?f?f.p(i,m):(f=te(i),f.c(),f.m(e,c)):f&&(f.d(1),f=null);const C={};m&4&&(C.msg=i[2]?i[2].toString():null),u.$set(C),m&2&&x(e,"outline",i[1])},i(i){g||($(o),$(a.$$.fragment,i),$(u.$$.fragment,i),g=!0)},o(i){b(o),b(a.$$.fragment,i),b(u.$$.fragment,i),g=!1},d(i){i&&v(e),h[l].d(),V(a),_&&_.d(),f&&f.d(),V(u)}}}function Be(t,e,n){let l,o,s,a;O(t,K,p=>n(10,l=p)),O(t,me,p=>n(3,o=p)),O(t,de,p=>n(4,s=p)),O(t,pe,p=>n(5,a=p));const d=_e();let{ulo:r}=e,{chosen:c}=e,u=null;async function g(){if(r==="anonymous")throw new TypeError("cannot logout from anonymous user");if(l.has(r.ulid)){const p=U.uloWith(r.ulid);try{await p.logout(),U.uloDel(r.ulid),c&&U.uloReset(),d("reload")}catch(_){n(2,u=_)}}else console.warn(`unknown ulo ${r.ulid}; ignoring`),U.uloDel(r.ulid),d("reload")}function k(){if(r==="anonymous")throw new TypeError("cannot forget anonymous user");U.uloDel(r.ulid),d("reload")}const h=()=>d("choose");return t.$$set=p=>{"ulo"in p&&n(0,r=p.ulo),"chosen"in p&&n(1,c=p.chosen)},[r,c,u,o,s,a,d,g,k,h]}class ge extends ae{constructor(e){super();fe(this,e,Be,Le,ce,{ulo:0,chosen:1})}}function se(t,e,n){const l=t.slice();return l[14]=e[n][0],l[15]=e[n][1],l}function Te(t){let e,n;return e=new W({props:{level:"error",$$slots:{default:[ze]},$$scope:{ctx:t}}}),{c(){L(e.$$.fragment)},l(l){B(e.$$.fragment,l)},m(l,o){T(e,l,o),n=!0},p(l,o){const s={};o&262148&&(s.$$scope={dirty:o,ctx:l}),e.$set(s)},i(l){n||($(e.$$.fragment,l),n=!0)},o(l){b(e.$$.fragment,l),n=!1},d(l){V(e,l)}}}function Ve(t){let e=t[4]("iori.synched",{values:{synched:t[2]}})+"",n;return{c(){n=P(e)},l(l){n=J(l,e)},m(l,o){y(l,n,o)},p(l,o){o&20&&e!==(e=l[4]("iori.synched",{values:{synched:l[2]}})+"")&&R(n,e)},i:A,o:A,d(l){l&&v(n)}}}function Oe(t){let e=t[4]("iori.anonymous")+"",n;return{c(){n=P(e)},l(l){n=J(l,e)},m(l,o){y(l,n,o)},p(l,o){o&16&&e!==(e=l[4]("iori.anonymous")+"")&&R(n,e)},i:A,o:A,d(l){l&&v(n)}}}function Ae(t){let e,n;return e=new Ue({}),{c(){L(e.$$.fragment)},l(l){B(e.$$.fragment,l)},m(l,o){T(e,l,o),n=!0},p:A,i(l){n||($(e.$$.fragment,l),n=!0)},o(l){b(e.$$.fragment,l),n=!1},d(l){V(e,l)}}}function Pe(t){let e;return{c(){e=P("Not synched")},l(n){e=J(n,"Not synched")},m(n,l){y(n,e,l)},p:A,i:A,o:A,d(n){n&&v(e)}}}function ze(t){let e,n=t[2].message+"",l;return{c(){e=P("Error: "),l=P(n)},l(o){e=J(o,"Error: "),l=J(o,n)},m(o,s){y(o,e,s),y(o,l,s)},p(o,s){s&4&&n!==(n=o[2].message+"")&&R(l,n)},d(o){o&&v(e),o&&v(l)}}}function Je(t){let e,n,l,o;const s=[Pe,Ae,Oe,Ve,Te],a=[];function d(r,c){return r[2]===null?0:r[2]===void 0?1:r[2]==="anonymous"?2:"uid"in r[2]?3:r[2]instanceof Error?4:-1}return~(e=d(t))&&(n=a[e]=s[e](t)),{c(){n&&n.c(),l=M()},l(r){n&&n.l(r),l=M()},m(r,c){~e&&a[e].m(r,c),y(r,l,c),o=!0},p(r,c){let u=e;e=d(r),e===u?~e&&a[e].p(r,c):(n&&(H(),b(a[u],1,1,()=>{a[u]=null}),Y()),~e?(n=a[e],n?n.p(r,c):(n=a[e]=s[e](r),n.c()),$(n,1),n.m(l.parentNode,l)):n=null)},i(r){o||($(n),o=!0)},o(r){b(n),o=!1},d(r){~e&&a[e].d(r),r&&v(l)}}}function ie(t){let e,n,l;function o(){return t[10](t[15])}return n=new ge({props:{ulo:t[15],chosen:t[3]===t[15].ulid&&!t[0]}}),n.$on("choose",o),n.$on("reload",t[8]),{c(){e=D("div"),L(n.$$.fragment),this.h()},l(s){e=I(s,"DIV",{class:!0});var a=z(e);B(n.$$.fragment,a),a.forEach(v),this.h()},h(){N(e,"class","ulo-view svelte-1izeph2")},m(s,a){y(s,e,a),T(n,e,null),l=!0},p(s,a){t=s;const d={};a&2&&(d.ulo=t[15]),a&11&&(d.chosen=t[3]===t[15].ulid&&!t[0]),n.$set(d)},i(s){l||($(n.$$.fragment,s),l=!0)},o(s){b(n.$$.fragment,s),l=!1},d(s){s&&v(e),V(n)}}}function re(t){let e,n,l=(!t[15].invalid||t[5])&&ie(t);return{c(){l&&l.c(),e=M()},l(o){l&&l.l(o),e=M()},m(o,s){l&&l.m(o,s),y(o,e,s),n=!0},p(o,s){!o[15].invalid||o[5]?l?(l.p(o,s),s&34&&$(l,1)):(l=ie(o),l.c(),$(l,1),l.m(e.parentNode,e)):l&&(H(),b(l,1,1,()=>{l=null}),Y())},i(o){n||($(l),n=!0)},o(o){b(l),n=!1},d(o){l&&l.d(o),o&&v(e)}}}function ue(t){let e,n,l;return n=new ge({props:{ulo:"anonymous",chosen:[null,"anonymous"].includes(t[3])&&!t[0]}}),n.$on("choose",t[11]),{c(){e=D("div"),L(n.$$.fragment),this.h()},l(o){e=I(o,"DIV",{class:!0});var s=z(e);B(n.$$.fragment,s),s.forEach(v),this.h()},h(){N(e,"class","ulo-view svelte-1izeph2")},m(o,s){y(o,e,s),T(n,e,null),l=!0},p(o,s){const a={};s&9&&(a.chosen=[null,"anonymous"].includes(o[3])&&!o[0]),n.$set(a)},i(o){l||($(n.$$.fragment,o),l=!0)},o(o){b(n.$$.fragment,o),l=!1},d(o){o&&v(e),V(n)}}}function Me(t){let e,n=t[4]("iori.switcher.or")+"",l;return{c(){e=new Ee(!1),l=M(),this.h()},l(o){e=Se(o,!1),l=M(),this.h()},h(){e.a=l},m(o,s){e.m(n,o,s),y(o,l,s)},p(o,s){s&16&&n!==(n=o[4]("iori.switcher.or")+"")&&e.p(n)},d(o){o&&v(l),o&&e.d()}}}function Re(t){let e,n,l,o=t[4]("iori.switcher.switch")+"",s,a,d,r,c,u,g;n=new W({props:{level:"info",$$slots:{default:[Je]},$$scope:{ctx:t}}});let k=t[1],h=[];for(let f=0;f<k.length;f+=1)h[f]=re(se(t,k,f));const p=f=>b(h[f],1,1,()=>{h[f]=null});let _=(t[6]||t[3]=="anonymous")&&ue(t);return u=new W({props:{level:"info",$$slots:{default:[Me]},$$scope:{ctx:t}}}),{c(){e=D("div"),L(n.$$.fragment),l=q(),s=P(o),a=q();for(let f=0;f<h.length;f+=1)h[f].c();d=q(),_&&_.c(),r=q(),c=D("div"),L(u.$$.fragment),this.h()},l(f){e=I(f,"DIV",{class:!0});var i=z(e);B(n.$$.fragment,i),l=j(i),s=J(i,o),a=j(i);for(let E=0;E<h.length;E+=1)h[E].l(i);d=j(i),_&&_.l(i),r=j(i),c=I(i,"DIV",{class:!0});var m=z(c);B(u.$$.fragment,m),m.forEach(v),i.forEach(v),this.h()},h(){N(c,"class","ulo-view svelte-1izeph2"),N(e,"class","switcher")},m(f,i){y(f,e,i),T(n,e,null),S(e,l),S(e,s),S(e,a);for(let m=0;m<h.length;m+=1)h[m].m(e,null);S(e,d),_&&_.m(e,null),S(e,r),S(e,c),T(u,c,null),g=!0},p(f,[i]){const m={};if(i&262164&&(m.$$scope={dirty:i,ctx:f}),n.$set(m),(!g||i&16)&&o!==(o=f[4]("iori.switcher.switch")+"")&&R(s,o),i&427){k=f[1];let w;for(w=0;w<k.length;w+=1){const C=se(f,k,w);h[w]?(h[w].p(C,i),$(h[w],1)):(h[w]=re(C),h[w].c(),$(h[w],1),h[w].m(e,d))}for(H(),w=k.length;w<h.length;w+=1)p(w);Y()}f[6]||f[3]=="anonymous"?_?(_.p(f,i),i&72&&$(_,1)):(_=ue(f),_.c(),$(_,1),_.m(e,r)):_&&(H(),b(_,1,1,()=>{_=null}),Y());const E={};i&262160&&(E.$$scope={dirty:i,ctx:f}),u.$set(E)},i(f){if(!g){$(n.$$.fragment,f);for(let i=0;i<k.length;i+=1)$(h[i]);$(_),$(u.$$.fragment,f),g=!0}},o(f){b(n.$$.fragment,f),h=h.filter(Boolean);for(let i=0;i<h.length;i+=1)b(h[i]);b(_),b(u.$$.fragment,f),g=!1},d(f){f&&v(e),V(n),ke(h,f),_&&_.d(),V(u)}}}function Ce(t,e,n){let l,o,s,a,d;O(t,K,i=>n(9,l=i)),O(t,Ne,i=>n(3,o=i)),O(t,me,i=>n(4,s=i)),O(t,de,i=>n(5,a=i)),O(t,pe,i=>n(6,d=i));const r=_e();let{force:c=!1}=e;async function u(i){if(i===null||i==="anonymous")U.uloReset(),n(2,p=null);else{U.uloUse(i);try{await U.loginSync()}catch(m){m instanceof ee?(console.error("ul id invalid",i),i!=="anonymous"&&(l.set(i,G(F({},l.get(i)),{invalid:!0})),K.set(l))):(console.error("syncing failed",m),n(2,p=m))}}await h(),r("choose",{ulid:i})}let g=!1,k;h();async function h(){if(g){g=!1;return}console.log("reload",l),n(1,k=[...l.entries()]);try{n(2,p=await U.synchedLogin()),p===null&&(await U.loginSync(),n(2,p=await U.synchedLogin()))}catch(i){const m=o;i instanceof ee?(console.error("ul id invalid",m),m!=="anonymous"?(l.set(m,G(F({},l.get(m)),{invalid:!0})),K.set(l),g=!0,n(2,p=null)):n(2,p="anonymous")):(console.error("syncing failed",i),n(2,p=i))}}let p;const _=i=>{u(i.ulid),h()},f=()=>u("anonymous");return t.$$set=i=>{"force"in i&&n(0,c=i.force)},t.$$.update=()=>{t.$$.dirty&512&&h()},[c,k,p,o,s,a,d,u,h,l,_,f]}class Ze extends ae{constructor(e){super();fe(this,e,Ce,Re,ce,{force:0})}}export{Ze as S};
